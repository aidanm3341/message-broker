---
order: 5
title: Scopes
---

Message scoping is a mechanism for restricting which subscribers will receive a given message.
You can create a new scope on a messagebroker by calling `createScope`.

```typescript
const parent: IMessageBroker<IContract> 
    = messagebroker<IContract>();

const child: IMessageBroker<IContract> 
    = parent.createScope();
```

A scope is just another instance of an `IMessageBroker` on which you can perform all of the same operations that you'd expect on the base messagebroker.
The main thing to note about this feature is how messages are handled when a scope doesn't have any subscribers for a channel.

### Scope Hierarchies

Any message that is published to a broker will be passed up the chain of scopes until a handler for the message is found.

```typescript
parent.get('x').subscribe(message => console.log('parent received'));

child.create('x').publish({});

// expect: parent received
```

However messages are **not** sent up the hierarchy if the channel in the child has been subscribed to.

```typescript
parent.get('x').subscribe(message => console.log('parent received'));
child.get('x').subscribe(message => console.log('child received'));

child.create('x').publish({});

// expect: child received
```

Messages are also not published to "sibling" scopes, where the brokers share a parent.

```typescript
const sibling: IMessageBroker<IContract> 
    = parent.createScope();

parent.get('x').subscribe(message => console.log('parent received'));
child.get('x').subscribe(message => console.log('child received'));
sibling.get('x').subscribe(message => console.log('sibling received'));

sibling.create('x').publish({});

// expect: sibling received
```

### Scope Depth

Scope hierarchies can be arbitrarily deep, and messages will make their way all the way to the top to find a handler.

```typescript
const distantChild = parent
    .createScope()
    .createScope()
    ...
    .createScope();

parent.get('x').subscribe(message => console.log('parent received'));

distantChild.create('x').publish({});

// expect: parent received
```

### Destroy

A MessageBroker instance can be destroyed.
Destroying a MessageBroker will first destroy all of its children, it will dispose of all its channels, and finally remove itself from its parent.

```typescript
child.destroy();
parent.children.contains(child); // expect: false
```